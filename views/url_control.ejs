<html lang="en">
    <head>
        <%- include('./includes/head.ejs') %>
    </head>

<body class="p-3">
    

        <h3 class="font-bold uppercase text-sm">Page actuelle</h3>
        <h2 class="text-xl mb-5" id="actual-page">vide</h2>

        <div class="grid gap-3" id="URL-list">
            <% if(Object.keys(data).length === 0) {%>
                
                <h3 class="font-bold text-sm text-red-400">Aucune URL ajout√©e !</h3>

            <%} else { 
                    Object.entries(data).forEach(entry => {
                        const [key, value] = entry;%>

                        <div class="flex w-full items-center">
                            <button class="btn w-full" onclick="send_page(this.getAttribute('data-url'))" data-url="<%=value%>">
                                <%= key %>    
                            </button>
                            <form method="POST" action="/url/remove">
                                <input type="hidden" name="id" value="<%= id %>" />
                                <input type="hidden" name="name" value="<%= key %>" />
                                <input type="submit" class="rounded border p-1 ml-2 w-9 text-red-50 hover:bg-white hover:text-red-500" value="X"/> 
                            </form>
                        </div>
                    <%});
            } %> 
        </div>

        <div class="p-4 rounded-lg bg-gray-800 mt-5">
            <form action="/url/add/" method="post">
            
                <h3 class="uppercase font-bold mb-1">Ajouter une URL</h3>
                <div>
                    <label class="text-white">Nom</label>
                    <input type="text" class="text-input w-full" id="name" name="name" placeholder="Ma page">
                </div>
                
                <div class="mt-3">
                    <label class="text-white">URL</label>
                    <input type="text" class="text-input w-full" id="url" name="url" placeholder="https://google.com/">
                </div>

                <input type="hidden" value="<%= id %>" name="id"/>

                <% if (errorMsg) {%>
                    <div class="alert"><%= errorMsg %></div>
                <%}%>

                <input type="submit" class="btn w-full mt-3" value="Ajouter" id="submit"></button>

            </form>

        </div>

        <p class="text-gray-800">id : <%= id %></p>

        

  
    <script type="text/javascript">

        const bcId = 'livesahb-url-'+"<%= id %>";
        let bc = new BroadcastChannel(bcId);

        // const urlLabel = document.querySelector("#actual-page")
        // const urlList = document.querySelector("#URL-list")

        // const inputName = document.querySelector("#name");
        // const inputURL = document.querySelector("#url");
        // const inputSubmit = document.querySelector("#submit");

        function send_page(url) {
            console.log("Lancement de "+ url)
            bc.postMessage(url)
        }

  

    </script>
    
</body>
</html>