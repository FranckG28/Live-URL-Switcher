<html lang="en">
    <head>
        <%- include('./includes/head.ejs') %>
    </head>

<body class="p-3">

        <div class="grid gap-2" id="URL-list">
            <% if(Object.keys(data).length === 0) {%>
                
                <h3 class="font-bold text-sm text-red-400">Aucune URL ajout√©e !</h3>

            <%} else { 
                    Object.entries(data).forEach(entry => {
                        const [key, value] = entry;%>

                        <div class="flex w-full items-center">
                            <button class="btn w-full" onclick="send_page(this.getAttribute('data-url'))" data-url="<%=value%>">
                                <%= key %>    
                            </button>
                            <form method="POST" action="/url/remove">
                                <input type="hidden" name="id" value="<%= id %>" />
                                <input type="hidden" name="name" value="<%= key %>" />
                                <input type="submit" class="hover:rounded p-1 ml-2 w-9 text-red-500 bg-transparent hover:bg-red-500 hover:text-white" value="x"/> 
                            </form>
                        </div>
                    <%});
            } %> 
        </div>

        <div class="p-4 rounded-lg bg-gray-800 mt-5">
            <form action="/url/add/" method="post">
            
                <h3 class="uppercase font-bold mb-1">Add a new URL</h3>
                <div>
                    <label class="text-white">Name</label>
                    <input type="text" class="text-input w-full" id="name" name="name" placeholder="My page">
                </div>
                
                <div class="mt-3">
                    <label class="text-white">URL</label>
                    <input type="text" class="text-input w-full" id="url" name="url" placeholder="https://google.com/">
                </div>

                <input type="hidden" value="<%= id %>" name="id"/>

                <% if (errorMsg) {%>
                    <div class="alert"><%= errorMsg %></div>
                <%}%>

                <input type="submit" class="btn w-full mt-3" value="Add" id="submit"></button>

            </form>

        </div>

        <p class="text-gray-800">id : <%= id %></p>

        

  
    <script type="text/javascript">

        const bcId = 'live-url-'+"<%= id %>";
        let bc = new BroadcastChannel(bcId);

        function send_page(url) {
            console.log("Sended "+ url + " on broadcaster id " + bcId);
            bc.postMessage(url);
        }

    </script>
    
</body>
</html>